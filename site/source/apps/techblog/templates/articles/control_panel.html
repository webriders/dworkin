{% load user_avatar update_filters %}

<div class="control-panel">
    {% if request.user.is_authenticated %}
        <div class="filter">
            <h3>Моё</h3>
            <a class="all" href=".">все</a>
            <div class="clear"></div>
            <ul class="categories">
                    <li class="{% if own_articles %}selected{% endif %} {% if not own_articles_count %}disabled{% endif %}">
                        <div class="button"></div>
                        <a href="/articles/{% update_filters the_filter own="articles" all_category=1 all_tags=1 %}">Статьи ({{ own_articles_count }})</a>
                    </li>
                    <li class="{% if own_drafts %}selected{% endif %} {% if not own_drafts_count %}disabled{% endif %}">
                        <div class="button"></div>
                        <a href="/articles/{% update_filters the_filter own="drafts" all_category=1 all_tags=1 %}">Черновики ({{ own_drafts_count }})</a>
                    </li>
            </ul>
        </div>
        <div class="clear"></div>
    {% endif %}

    {% if selected_author %}
        <div class="filter">
            <h3>Автор</h3>
            <a class="all" href="/articles/{% update_filters the_filter all_author=1 %}">все</a>
            <div class="clear"></div>

            {% with selected_author as user %}
                <div class="author">
                    <div class="author-photo">
                        <a href="/users/{{ user.username }}/">{% user_avatar user 64 %}</a>
                    </div>
                    <a class="title" href="/users/{{ user.username }}/">{{ user.username }}</a>
                </div>
            {% endwith %}
        </div>
        <div class="clear"></div>
    {% endif %}

    <div class="filter">
        <h3>Категории</h3>
        <a class="all" href="/articles/{% update_filters the_filter all_category=1 %}">все</a>
        <div class="clear"></div>

        <ul class="categories">
            {% for category in categories %}
                {% if category.disabled %}
{#                    <li class="disabled">#}
{#                        <div class="button"></div>#}
{#                        <a href="/articles/{% update_filters the_filter category=category.slug all_tags=1 %}">{{ category.title }} ({{ category.count }})</a>#}
{#                    </li>#}
                {% else %}
                    <li class="{% if category.selected %}selected{% endif %}">
                        <div class="button"></div>
                        <a href="/articles/{% update_filters the_filter category=category.slug %}">{{ category.title }} ({{ category.count }})</a>
                    </li>
                {% endif %}
            {% endfor %}
        </ul>
    </div>
    <div class="clear"></div>

    <div class="filter">
        <h3>Теги</h3>
        <a class="all" href="/articles/{% update_filters the_filter all_tags=1 %}">все</a>
        <div class="clear"></div>
        <div class="tag-cloud">
            {% for tag in tag_cloud %}
                {% if tag.disabled %}
{#                    <a href="#" class="disabled">#}
{#                        {{ tag.name }} ({{ tag.count }})#}
{#                    </a>#}
                {% else %}
                 <a href="/articles/{% update_filters the_filter tag=tag.slug %}" class="{% if tag.selected %}selected{% endif %}">
                        {{ tag.name }} ({{ tag.count }})
                    </a>
                {% endif %}
            {% endfor %}
        </div>
    </div>
    <div class="clear"></div>
</div>
<div class="clear"></div>